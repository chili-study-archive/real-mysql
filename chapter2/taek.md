# VARCHAR vs TEXT

## 1. 공통점
- 문자열 속성 값을 저장하는 타입
- 최대 65,535 바이트까지 저장이 가능하다

## 2. 차이점
- VARCAHR 타입 컬럼에는 지정된 글자 수 만큼 데이터 저장이 가능하다
- TEXT타입 컬럼은 인덱스 생성 시 반드시 PREFIX 길이 지정이 필요하다
  - `CREATE INDEX ix_text_column ON table (text_column(100));`
  - 인덱스 키로 지정할 수 있는 최대 사이즈를 넘겨서 PREFIX 길이로 잡으면 인덱스 생성이 불가능하다 (VARCHAR도 동일) 
- TEXT타입 컬럼은 표현식으로만 디폴트 값 지정 가능 (괄호 사용해야 함)
  - `CREATE TABLE tb1 (col TEXT DEFAULT 'abc')` (X)
  - `CREATE TABLE tb1 (col TEXT DEFAULT ('abc'))` (O)

## 3. 권장 사용방식
- MySQL은 세션에서 테이블의 레코드를 읽을 때 메모리에 버퍼 공간을 미리 할당해두고 유지하며 재활용한다
- VARCHAR 타입은 메모리 버퍼 공간에 포함돼서 재활용 가능한 반면, TEXT 타입은 그때 그때 필요할 때마다 할당 및 해제된다
### 1) VARCHAR
- 상대적으로 저장되는 데이터 사이즈가 많이 크지 않고, 컬럼 사용이 빈번하며 DB 서버의 메모리 용량이 충분할 때 사용을 권장한다
  - VARCHAR 컬럼이 테이블에 많이 존재하는 경우 로우 사이즈 제한에 쉽게 도달할 수 있다
  - 재활용되므로 컬럼 사용이 빈번할 때 유리하다
- VARCHAR를 사용할 땐 길이는 실제 사용되는 만큼만 지정해야 메모리 사용 효율이 증가한다
  - 데이터의 길이 정보도 차이가 날 수 있다 (1바이트 vs 2바이트)
  - 자세한 내용은 [1장](../chapter1/taek.md) 참고
### 2) TEXT
- 저장되는 데이터 사이즈가 큰 편이고, 컬럼을 자주 사용하지 않으며 테이블에서 다른 문자열 컬럼들이 많이 사용되고 있을 때 사용을 권장한다
  - 로우 사이즈 제한에 영향을 받지 않는다 
  - 재활용되지 않고, 매번 할당 및 해제되므로 컬럼 사용 빈도가 적을 때 유리하다

## 4. 주의사항
- **저장되는 값의 사이즈가 크면 해당 컬럼은 Off-Page 형태로 저장될 수 있음**
  - Off-Page? 별도의 외부 페이지(= External Off Page, Overflow Page - Disk 내에 존재)에 컬럼 데이터가 저장되고, 원래 위치에는 포인터만 저장되는 형태
  - 포인터를 저장하는 크기는 MySQL 버전마다 다름, 최신 버전의 
  - Dynamic Row 포맷은 20 바이트를 사용
- **쿼리의 SELECT절에는 가능하면 필요한 컬럼들만 명시하는 것이 좋다**
   - 쿼리에서 Off-Page 컬럼을 참조하면 Disk I/O가 발생하므로 성능이 떨어진다
   - 필요한 컬럼만 명시하면 경우에 따라 커버링 인덱스 방식으로 처리될 가능성이 높아진다
     - 커버링 인덱스? 쿼리가 필요한 모든 데이터를 인덱스만으로 해결할 수 있는 인덱스
     - 인덱스에 포함된 컬럼들로만 쿼리가 가능하므로 데이터 테이블에 직접 접근할 필요 없이 인덱스만을 통해 데이터를 조회할 수 있다
