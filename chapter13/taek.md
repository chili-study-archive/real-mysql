# 콜레이션(Collation)

## 1. 의미
- 문자열을 비교하거나 정렬할 때 사용되는 규칙
- 문자집합(Character Set)에 종속적인 구조를 취함

## 2. 콜레이션 종류
- 네이밍 규칙: 문자집합_언어종속_UCA버전_민감도
  - 문자집합: 문자와 코드값의 조합이 정의된 것
  - 언어종속: 특정 언어에 대해 콜레이션이 적용됨을 나타냄
  - UCA버전: Unicode Collation Algorithm Version (=문자열 비교 알고리즘)
  - 민감도: 악센트, 대소문자 구분을 하는지, 바이너리값 구분을 하는지 등을 명시

## 3. 콜레이션 동작 방식
- 데이터 저장
  - 코드 포인트 값을 인코딩해서 저
- 데이터 비교
  - Primary, Seconda장y, Tertiary 3가지 단계의 가중치 값이 존재
  - 콜레이션 별로 사용되는 가중치 값의 범위가 다름
    - e.g. ai_ci는 1단계(Primary), as_cs는 3단계(Tertiary)까지 존재
  - `WEIGHT_STRING()` 함수를 통해 문자열의 가중치 값을 확인할 수 있음

## 4. 콜레이션 설정
### 1) 글로벌 설정
- 특별히 지정하지 않는 경우 서버의 기본 콜레이션으로 자동 설정됨
- 문자집합과 콜레이션 모두를 지정하지 않는 경우, utf8mb4 문자집합 & utf8mb4_0900_ai_ci 콜레이션으로 설정됨
- character_set_server & collation_server 설정 변수를 통해 원하는 문자집합 및 콜레이션 설정 가능
### 2) 개별 설정
- 데이터베이스/테이블/컬럼 단위로 독립적으로 지정하는 것이 가능


## 5. 콜레이션 사용 시 주의사항
1. 서로 다른 콜레이션을 가진 컬럼 간에 값 비교 시 에러가 발생함
2. WHERE절에서 문자열 컬럼의 콜레이션을 변경할 수 있으나, 이 경우 인덱스를 사용할 수 없음 
3. Unique Key도 콜레이션의 영향을 영향을 받음 (콜레이션이 다르면 제대로 고유성을 검증하지 못할 수 있음)
4. MySQL의 기본 콜레이션인 utf8mb4_0900_ai_ci은 한글 비교 문제가 있음 
   1. 이는 같은 문자더라도 초성, 중성, 종성, 개별 문자인지에 따라 가중치가 다르기 때문
   2. 정확한 한글 구분이 필요한 경우엔 다른 콜레이션을 사용할 수 있음
5. 대소문자 구분을 윙해선 별도의 콜레이션을 지정해야 함
   1. MySQL의 기본 콜레이션인 utf8mb4_0900_ai_ci은 대소문자를 구분 X
   2. utf8mb4 문자집합 중 utf8mb4_bin, utf8mb4_0900_bin, utf8mb4_0900_as_cs는 대소문자를 구분한다
   3. 후행 공백 인식, 구분 정도 등에 따라 위 콜레이션을 취사선택한다
      1. 후행 공백 인식 X -> utf8mb4_bin
      2. 후행 공백 인식 O && 대소문자 구분 정도면 OK -> utf8mb4_0900_as_cs는
      3. 후행 공백 인식 O && 모든 문자 구분 -> utf8mb4_0900_bin
