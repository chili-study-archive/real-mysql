# CHAR vs VARCHAR

## 1. 공통점
- 문자열 저장용 컬럼이다
- **바이트 수가 아닌, 최대 저장 가능 문자 길이를 명시한다**

## 2. 차이점
- CHAR 타입은 값의 실제 크기에 관계없이 고정된 공간 할당하는 반면, VARCHAR 타입은 가변적으로 공간을 할당한다
- CHAR 타입은 255자리까지 저장 가능한 반면, VARCHAR 타입은 16383자리까지 저장 가능하다.
- CHAR 타입은 저장된 값의 길이를 관리하지 않지만, VARCHAR 타입은 저장된 값의 길이를 관리하는 길이 저장 바이트가 있다.
  - 0 ~ 255 bytes -> length-bytes: 1
  - 256 ~ 65535 bytes -> length-bytes: 2


# 3. 문자셋에 다른 메모리 할당방식
### 1) Latin1 (고정 길이 문자셋)
- CHAR(10): 문자 데이터 4바이트 + 공백 문자 데이터 6바이트
- VARCHAR(10): 길이 저장용 1바이트 + 문자 데이터 4바이트
### 2) UTF-8mb4 (가변 길이 문자셋)
- CHAR(10): 한글 한 글자에 3바이트, 바이트 수 기준으로 공백을 채움 (+ 가변길이 문자셋인 경우엔 CHAR 타입이라 하더라도 길이 저장용 바이트를 사용한다)
  - "한글": 길이 저장용 1바이트(10) + 문자 데이터 6바이트 + 공백 문자 데이터 4바이트 (10-6 = 4)
  - "한글연습" 길이 저장용 1바이트(12) + 문자 데이터 12바이트 + 공백 문자 데이터 0바이트
- VARCHAR(10): 문자셋 관계없이 꼭 필요한 만큼만 공간 사용

# 4. CHAR 타입의 공간 낭비?
- 일반적으로 알고 있는 기준은 고정된 길이의 값 저장은 CHAR 타입, 그게 아니라면 VARCHAR 타입으로 알고 있다
- CHAR와 VARCHAR의 가장 큰 차이는 공간을 미리 예약하는지 여부이며, 이에 따라 CHAR는 공간 낭비 발생한다
  - 문자열의 최소-최대 길이의 가변 폭이 큰 경우엔 공간 낭비가 심하다
  - 문자열의 최소-최대 길이의 가변 폭이 좁고 경우엔 공간 낭비가 심하지 않다
- VARCHAR는 저장되는 값이 바뀌면 레코드를 옮겨야하고, 이에 따라 단편화가 발생한다
- **따라서 저장되는 문자열의 최소-최대 길이의 가변 폭이 좁고, 자주 변경되는 컬럼은 CHAR를 쓰는 게 유리하다**
  - CHAR는 공간을 미리 예약해두므로 레코드의 이동이 적고, 단편화가 적어서 공간 낭비가 줄어들 수 있음

# 5. 문자열 타입 선정 기준
### 1) CHAR를 선택하는 경우
- 문자열의 최소-최대 길이의 가변 폭이 좁고
- 값이 자주 변경되는 경우 (특히 인덱스된 컬럼인 경우)
### 2) VARCHAR를 선택하는 경우
- 문자열의 최소-최대 길이의 가변 폭이 크고
- 값이 자주 변경되지 않는 경우
