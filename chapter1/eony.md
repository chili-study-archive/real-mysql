# CHAR vs VARCHAR

## 공통점
- 문자열 저장용 컬럼
- 최대 저장 가능 문자 길이를 명시함
    - ex) VARCHAR(10) -> 10글자를 나타냄 (바이트 아님 주의!)

## 차이점
### 1. 저장 공간 할당 방식이 다르다

(1) VARCHAR
- 저장하고자 하는 문자의 크기만큼만 저장 공간 할당

(2) CHAR
- 실제로 저장하려는 문자의 크기와 상관없이 명시된 크기를 고정해서 사용함
    - EX) CHAR(255)면 한 글자를 저장하더라도 무조건 CHAR(255)만큼의 저장공간을 할당받음

### 2. 최대 저장 길이가 다르다
(1) VARCHAR
- 16383 글자

(2) CHAR
- 255 글자

### 3. 저장된 값의 길이 관리 여부가 다르다
(1) VARCHAR
- 저장된 값의 길이를 관리함 (1바이트 혹은 2바이트를 사용)

(2) CHAR
- 일반적으론 관리하지 않지만, utfmb4와 같은 가변길이 문자를 사용하면 VARCHAR와 같이 관리를 함

<br>

## 중요 포인트
### CHAR를 써야할까, VARCHAR를 써야할까?

일반적으로 사용되는 간단한 기준
> 고정된 길이는 CHAR를 쓰고 아닐땐 VARCHAR를 쓴다. (사실상 앵간하면 VARCHAR를 쓴다) 

**약간은 잘못된 기준일 수 있음!**

가장 고려해야할 조건은 **문자열의 최소-최대 길이의 가변폭**임

<br>

### 문자열이 업데이트되어 길이가 변경되는 경우를 상상해보자.

(1) VARCHAR

1. 새로운 문자열을 저장할 수 있는 저장 공간을 찾음
2. 해당 공간에 데이터를 저장
3. 기존에 저장된 데이터를 delete marking함

해당 과정이 반복될수록 메모리 단편화가 일어나서 빈 메모리를 찾기 어려워지고, Compaction과 Page Recognization 작업이 빈번해짐.

<br>

(2) CHAR

이미 지정된 사이즈만큼의 메모리가 예약되어있으므로, 새로운 데이터를 옮겨쓰는 과정이 필요없음!

이미 해당 길이를 위한 저장공간이 마련되어있음.

<br>

### 무엇이 더 나은 선택일지에 대한 정리

만약 저장하려는 문자열의 최대 길이 가변폭이 클 것으로 예상된다?

- CHAR를 쓰면 우선 최대 길이를 기준으로 데이터 공간을 무조건 할당받기 때문에 메모리 낭비가 심할 수 있음.


만약 저장하려는 문자열의 최대 길이 가변폭이 그렇게 크지 않을 것으로 예상된다?

- CHAR를 사용해도 낭비되는 메모리가 그렇게 크지 않을 수 있고, 업데이트가 빈번히 일어날 가능성이 높다면 오히려 VARCHAR보다 성능 상 유리할 수 있음
- 업데이트가 많이 일어나는 경우(특히 인덱스 컬럼인 경우), CHAR가 공간 효율성이 더 높을 수 있음. 


### 조금 더 알아보고 싶은 것
- utf8mb4 등의 charset의 간단한 차이점
    - 기존에 텍스트를 utf8로 저장하다가 해당 charset에 이모지가 입력되지 않는 케이스가 있었음.
    - 한 글자 당 할당하는 바이트 수가 다르다 정도만 알고 있었는데 너무 깊이는 아니더라도 대략적인 차이점 정도는 알고 있어도 좋을 듯